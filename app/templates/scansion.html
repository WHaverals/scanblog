{% extends "base.html" %}
{% block content %}

<!DOCTYPE html>
<html>
<head>
	<!-- Meta -->
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Page Title -->
	<title>De Maat van het Middelnederlands</title>
	<!-- Google Fonts css-->
	<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900%7CRubik:300,400,500,700,900" rel="stylesheet">
	<!-- Bootstrap css -->
	<link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css" media="screen">
	<!-- Font Awesome icon css-->
	<link rel="stylesheet" type="text/css" href="/static/css/font-awesome.min.css" media="screen">
	<link rel="stylesheet" type="text/css" href="/static/css/flaticon.css" media="screen">
	<!-- Swiper's CSS -->
	<link rel="stylesheet" type="text/css" href="/static/css/swiper.min.css">
	<!-- Animated css -->
	<link rel="stylesheet" type="text/css" href="/static/css/animate.css">
	<!-- Magnific Popup CSS -->
	<link rel="stylesheet" type="text/css" href="/static/css/magnific-popup.css">
	<!-- Slick nav css -->
	<link rel="stylesheet" type="text/css" href="/static/css/slicknav.css">
	<!-- Main custom css -->
	<link rel="stylesheet" type="text/css" href="/static/css/custom.css" media="screen">
	<link rel="stylesheet" type="text/css" href="/static/css/pages.css" media="screen">
	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body data-spy="scroll" data-target="#navigation" data-offset="71">
	
  <!-- Page Header Section Starts -->
  <section class="page-header" >
    <div class="container">
      <div class="row">
	<div class="col-lg-12">
	  <!-- Page Header start -->
	  <div class="page-header-title wow fadeInUp">
	    <h1>{{ title }}</h1>					
	  </div>
	  <!-- Page Header start -->
	</div>
      </div>
    </div>	
  </section>
  <!-- Banner Section Ends -->

  <div class="progress" style="height: 20px;">
    <div class="progress-bar bg-info" role="progressbar" aria-valuenow="0"
	 aria-valuemin="0" aria-valuemax="{{ scans.max }}" style="width:{{ scans.percent }}%">
      {{ scans.percent }}%
    </div>
  </div>
   
  <div class="page-blog">
    <div class="row">
      <div id="frag" class="container">
    	{% for line in lines %}
        <p>
	  <h3>
            {% for word in line %}
		{% for syllable in word %}	    
		<t href='' id="{{ syllable['id'] }}" onclick="changeColor('{{ syllable['id'] }}')">{{ syllable['text'] }}</t>
		{% endfor %}
		<divider class="divider"></divider>
            {% endfor %}
	  </h3>
        </p>
	{% endfor %}
    </div>
    </div>
  </div>
	
  <!-- submit button -->
  <section class="download-app-layout-5" id="download">
    <div class="c container-fluid">
      <div class="row">
	<div class="col-md-12 col-lg-12 col-xl-12">						
	  <p class="lead">
	    <g class="btn-download" onclick="save_and_submit()"><i class="flaticon-paper-plane"></i>Verstuur en naar volgende verzen!</g>
	  </p>
	</div>
      </div>
    </div>
  </section>
	

  <!-- Footer Section starts -->
  <footer class="footer-layout-3">
    <div class="container">
      <div class="row">
	
	<!-- Footer Copyright start -->
	<div class="copyright">
	  <p class="text-left col-md-12 col-lg-12 col-xl-12">Dit experiment maakt deel uit van het docotraatsonderzoek van Wouter Haverals en wordt gefinancierd door het Fonds voor Wetenschappelijk Onderzoek. Voor meer informatie over het project, kan u een bericht sturen naar <a href="mailto:wouter.haverals@uantwerpen.be">Wouter.Haverals@UAntwerpen.be</a></p>
	  <div class="col-lg-2 col-md-3 col-xl-2 offset-lg-0 col-sm-4 col-4 offset-xl-0"> <img src="/static/images/uafwo.png" alt="" /></div>
	</div>
	<!-- Footer Copyright end -->
	
      </div>
    </div>
  </footer>
  
</body>
</html>


<script>
var frag_id = {{ frag_id }};
var stressed_color = "#F37272";
function changeColor(id)

{
    console.log("logging!");
    color = document.getElementById(id).style.backgroundColor;
    accent = false;
    if (color === "") {
        document.getElementById(id).style.background = stressed_color;
        syl_stressed = true;
    } else {
        document.getElementById(id).style.background = "";
        syl_stressed = false;
    }
    $.ajax({
        contentType: 'application/json',
        url: 'save_annotation',
        data: JSON.stringify({syl_id: id, stressed: syl_stressed}),
        type: 'POST',
        datatype: 'json',
        success: (response) => console.log(response),
        error: (error) => console.log(error)
    });

}

// save and submit js function:

function save_and_submit() 
{
    console.log("logging!");
    var t_els = document.getElementsByTagName('t');
    var num = t_els.length;
    var stressed_list = []
    for (var i = 0; i < t_els.length; i++) { 
		var color = t_els[i].style.background; 
		//console.log("color of " + i + " el -> " + color);
		if (color !== "") {
			//append it to a list
			//this is a stressed element 
			//console.log("stressed el found!");
			var el = {syl_id:t_els[i].id, stressed:'True'}
			stressed_list.push(el)
		}
    }	
    //console.log('There are ' + num + ' t elements in this doc');
    //console.log('stressed_list ' + stressed_list.toSource())
	//return;
    $.ajax({
        contentType: 'application/json',
        url: 'finalize_annotation',
        data: JSON.stringify(stressed_list),
        type: 'POST',
        datatype: 'json',
        success: (response) => {
            console.log(response);
            window.location = "scansion" 

        },
        error: (error) => console.log(error)
    });    
}
</script>

{% endblock %}
